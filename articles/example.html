<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simple salmonMSE example • salmonMSE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simple salmonMSE example">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">salmonMSE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/example.html">Simple example</a></li>
    <li><a class="dropdown-item" href="../articles/model.html">Implementation</a></li>
    <li><a class="dropdown-item" href="../articles/equations.html">Dynamics equations</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Blue-Matter/salmonMSE/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simple salmonMSE example</h1>
            
            <h4 data-toc-skip class="date">2024-07-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Blue-Matter/salmonMSE/blob/master/vignettes/example.Rmd" class="external-link"><code>vignettes/example.Rmd</code></a></small>
      <div class="d-none name"><code>example.Rmd</code></div>
    </div>

    
    
<p>Here, we show a simple example of a salmon operating model where all
fish mature at age 3 and follows the structure of an analysis done in
AHA. The historical spool-up is not informed by an estimation model. The
model is used to project the proposed management levers to determine the
equilibrium properties of the system.</p>
<p>We create several S4 objects, the <code>Bio</code> object contains
the natural biological dynamics, including the maturity ogive
<code>p_mature</code>, fecundity, as well as the density-dependent
survival of smolts through the capacity and compensation ratio
parameters (<code>capacity_smolt</code> and <code>kappa</code>,
respectively).</p>
<p>To accommodate the life stage within the age structured model, we
model ocean survival as an equivalent instantaneous rate
<code>Mocean_NOS</code> where all mortality occurs in the age class
prior to maturation, i.e., age 2.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.salmonmse.com/">salmonMSE</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">class</span><span class="op">?</span><span class="va">SOM</span> <span class="co"># Definition of inputs</span></span>
<span></span>
<span><span class="va">SAR</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span><span class="va">Bio</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"Bio"</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  maxage <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  p_mature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  SRrel <span class="op">=</span> <span class="st">"BH"</span>,</span>
<span>  capacity_smolt <span class="op">=</span> <span class="fl">17250</span>,           <span class="co"># Beverton-Holt asymptote. Not unfished capacity!</span></span>
<span>  kappa <span class="op">=</span> <span class="fl">3</span>,                        <span class="co"># Productivity in recruits per spawner</span></span>
<span>  Mocean_NOS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">SAR</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  fec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">5040</span><span class="op">)</span>,              <span class="co"># Spawning fecundity of NOS and HOS</span></span>
<span>  p_female <span class="op">=</span> <span class="fl">0.49</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The next three objects control the management of the conservation
unit through habitat, hatchery, and harvest options.</p>
<p>Let’s leave the habitat unchanged from the <code>Bio</code>
object:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Habitat</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"Habitat"</span>,</span>
<span>  capacity_smolt_improve <span class="op">=</span> <span class="fl">1</span>,    <span class="co"># Keep carrying capacity unchanged</span></span>
<span>  kappa_improve <span class="op">=</span> <span class="fl">1</span>              <span class="co"># Keep productivity unchanged</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The hatchery dynamics are the most complex. We have a management
target to release 2 million yearlings.</p>
<p>After specifying the survival of broodtake (<code>s_prespawn</code>)
and the eggs in the hatchery, the model calculates the required number
of eggs annually for the target releases. The natural broodtake (NOB)
and hatchery broodtake (HOB) are taken to reach the target egg
production and maintain <code>NOB/(NOB + HOB) = ptarget_NOB</code>. The
proportion of NOB to the natural origin escapement cannot exceed
<code>pmax_NOB</code>. If the target egg production cannot be reached,
then the NOB is taken in accordance with <code>pmax_NOB</code> and HOB
is taken (up to the total hatchery origin escapement returned to the
hatchery) to meet the target egg production.</p>
<p>We also need to specify the relative fecundity of HOS compared to
NOS, and the fitness dynamics.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Hatchery</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"Hatchery"</span>,</span>
<span>  n_yearling <span class="op">=</span> <span class="fl">2e6</span>,               <span class="co"># Management lever. No hatchery if both this line and next line are zero</span></span>
<span>  n_subyearling <span class="op">=</span> <span class="fl">0</span>,              <span class="co"># Management lever. No hatchery if both this line and previous line are zero</span></span>
<span>  s_prespawn <span class="op">=</span> <span class="fl">1</span>,                 <span class="co"># Survival prior to spawning</span></span>
<span>  s_egg_smolt <span class="op">=</span> <span class="fl">0.92</span>,             <span class="co"># Survival of eggs in hatchery</span></span>
<span>  s_egg_subyearling <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  Mocean_HOS <span class="op">=</span> <span class="va">Bio</span><span class="op">@</span><span class="va">Mocean_NOS</span>,</span>
<span>  gamma <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  pmax_NOB <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  ptarget_NOB <span class="op">=</span> <span class="fl">0.51</span>,</span>
<span>  phatchery <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  premove_HOS <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">80</span><span class="op">)</span>,</span>
<span>  rel_loss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  fec_brood <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">5040</span><span class="op">)</span>,</span>
<span>  fitness_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ford"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  zbar_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">93.1</span>, <span class="fl">92</span><span class="op">)</span>,</span>
<span>  fitness_variance <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  selection_strength <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  heritability <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  fitness_floor <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We specify a harvest rate of 0.203 for the terminal fishery (mature
component). No hatchery fish are marked.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Harvest</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"Harvest"</span>,</span>
<span>  u_preterminal <span class="op">=</span> <span class="fl">0</span>,             <span class="co"># No pre-terminal fishery</span></span>
<span>  u_terminal <span class="op">=</span> <span class="fl">0.203</span>,            <span class="co"># Specify fixed harvest rate of mature fish</span></span>
<span>  m <span class="op">=</span> <span class="fl">0</span>,                         <span class="co"># Mark rate of hatchery releases</span></span>
<span>  release_mort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  vulPT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  vulT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>To start the projection, we specify the conditions for the spool-up
with the Historical object. We will have a two-year spool-up with an
escapement of 1000 natural origin fish and 1000 hatchery origin fish
each in the first generation (for all simulations). This is accomplished
by setting a spool-up period of 2 years (<code>nyears</code>) and
specify the immature abundance of age 1 fish at the beginning of year 1
and age 2 fish at the start of year 2. Since we model ocean survival
during age 2, abundance of the cohort doesn’t change.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Return of 1000 natural and hatchery fish each for the first generation</span></span>
<span><span class="va">nyears</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">HistN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Bio</span><span class="op">@</span><span class="va">nsim</span>, <span class="va">Bio</span><span class="op">@</span><span class="va">maxage</span>, <span class="va">nyears</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">HistN</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">HistN</span><span class="op">[</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1000</span><span class="op">/</span><span class="va">SAR</span></span>
<span></span>
<span><span class="va">Historical</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"Historical"</span>,</span>
<span>  HistN <span class="op">=</span> <span class="va">HistN</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now let’s stitch together the operating model and run the simulation
for 50 projection years (<code>proyears</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SOM</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"SOM"</span>,</span>
<span>  nyears <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  proyears <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  <span class="va">Bio</span>, <span class="va">Habitat</span>, <span class="va">Hatchery</span>, <span class="va">Harvest</span>, <span class="va">Historical</span></span>
<span><span class="op">)</span></span>
<span><span class="va">SMSE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/salmonMSE.html">salmonMSE</a></span><span class="op">(</span><span class="va">SOM</span><span class="op">)</span></span></code></pre></div>
<p>With a simple salmon model, we can run AHA and compare the trajectory
of the population. As we can see, the number of NOS in both models
stabilizes to the equilibrium value after approximately 15
generations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SAHA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AHA.html">AHA</a></span><span class="op">(</span><span class="va">SOM</span>, ngen <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare NOS</span></span>
<span><span class="va">SAHA</span><span class="op">$</span><span class="va">NOS</span></span>
<span><span class="va">SMSE</span><span class="op">@</span><span class="va">NOS</span><span class="op">[</span>, <span class="fl">1</span>, <span class="op">]</span></span></code></pre></div>
<p><img src="../reference/figures/example-NOS.png"><!-- --></p>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Quang Huynh.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>

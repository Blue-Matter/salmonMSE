<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simple salmonMSE example • salmonMSE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simple salmonMSE example">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">salmonMSE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/example.html">Simple example</a></li>
    <li><a class="dropdown-item" href="../articles/decision-table.html">Decision table</a></li>
    <li><a class="dropdown-item" href="../articles/example-multi.html">Multi-population model</a></li>
    <li><a class="dropdown-item" href="../articles/equations.html">Dynamics equations</a></li>
    <li><a class="dropdown-item" href="../articles/ref.html">Reference points</a></li>
    <li><a class="dropdown-item" href="../articles/conditioning.html">Conditioning model</a></li>
    <li><a class="dropdown-item" href="../articles/model.html">Implementation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Blue-Matter/salmonMSE/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simple salmonMSE example</h1>
            
            <h4 data-toc-skip class="date">2026-02-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Blue-Matter/salmonMSE/blob/master/vignettes/example.Rmd" class="external-link"><code>vignettes/example.Rmd</code></a></small>
      <div class="d-none name"><code>example.Rmd</code></div>
    </div>

    
    
<p>Here, we show a simple example of a salmon operating model where all
fish mature at age 3 and follows the structure of an analysis done in
AHA. The model is used to project the proposed management levers to
determine the equilibrium properties of the system.</p>
<div class="section level2">
<h2 id="biological-parameters">Biological parameters<a class="anchor" aria-label="anchor" href="#biological-parameters"></a>
</h2>
<p>We create several S4 objects, the <code>Bio</code> object contains
parameters controlling natural biological dynamics, including juvenile
ocean mortality, proportion mature by age class <code>p_mature</code>,
fecundity (egg production per female), as well as the density-dependent
egg-smolt survival relationship through the capacity and productivity
parameters (<code>capacity_smolt</code> and <code>kappa</code>,
respectively).</p>
<p>The first example will be deterministic. With salmonMSE, we must run
at minimum 2 simulation replicates, but we will run 3 simulations where
the biological parameters, as well as the results, are identical among
simulations.</p>
<p>We model ocean survival through an equivalent instantaneous mortality
rate <code>Mjuv_NOS</code> where all mortality occurs in the age class
prior to maturation, i.e., age 2.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.salmonmse.com/">salmonMSE</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">class</span><span class="op">?</span><span class="va">SOM</span> <span class="co"># Definition of inputs</span></span>
<span></span>
<span><span class="va">SAR</span> <span class="op">&lt;-</span> <span class="fl">0.01</span> <span class="co"># Marine survival</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># Number of simulations</span></span>
<span><span class="va">Bio</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"Bio"</span>,</span>
<span>  maxage <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  p_mature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  SRrel <span class="op">=</span> <span class="st">"BH"</span>,</span>
<span>  capacity <span class="op">=</span> <span class="fl">17250</span>,                 <span class="co"># Beverton-Holt asymptote. Not unfished capacity!</span></span>
<span>  kappa <span class="op">=</span> <span class="fl">3</span>,                        <span class="co"># Productivity in recruits per spawner</span></span>
<span>  Mjuv_NOS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">SAR</span><span class="op">)</span><span class="op">)</span>,       <span class="co"># Convert marine survival to an instantaneous mortality rate</span></span>
<span>  fec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">5040</span><span class="op">)</span>,              <span class="co"># Spawning fecundity of NOS and HOS</span></span>
<span>  p_female <span class="op">=</span> <span class="fl">0.49</span>,</span>
<span>  s_enroute <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="management-levers">Management levers<a class="anchor" aria-label="anchor" href="#management-levers"></a>
</h2>
<p>The next three objects control the management of the population
through habitat, hatchery, and harvest options.</p>
<div class="section level3">
<h3 id="habitat-and-freshwater-survival-parameters">Habitat and freshwater survival parameters<a class="anchor" aria-label="anchor" href="#habitat-and-freshwater-survival-parameters"></a>
</h3>
<p>Habitat parameters may represent different scenarios regarding
freshwater restoration and environmental factors that impact survival in
freshwater life stages, including pre-spawn mortality, egg survival, and
fry survival. The survival at each life stage can be either be
density-independent or density-dependent.</p>
<p>These features are not used in this example. Instead, the capacity
and productivity parameters in the previous section control the
egg-juvenile survival.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Habitat</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"Habitat"</span>,</span>
<span>  use_habitat <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="hatchery-dynamics">Hatchery dynamics<a class="anchor" aria-label="anchor" href="#hatchery-dynamics"></a>
</h3>
<div class="section level4">
<h4 id="hatchery-production">Hatchery production<a class="anchor" aria-label="anchor" href="#hatchery-production"></a>
</h4>
<p>Next, we work on the hatchery dynamics.</p>
<p>Below, we have a management target to release 10,000 yearlings
annually. In comparison, the carrying capacity of the natural
environment is 17,250 smolts. Users also specify the brood survival
(<code>s_prespawn</code>), egg survival in the hatchery
(<code>s_egg_smolt</code> and <code>s_egg_subyearling</code>) to
determine the hatchery egg production needed to support the release
strategy.</p>
<p>We place some additional constraints are placed which may prevent us
from realizing the target releases. The realized number of brood is
controlled by several parameters, including the maximum proportion of
the in-river return (escapement from marine fisheries) to be used as
brood (<code>pmax_esc</code>), the maximum proportion of natural
spawners to be used as broodtake (<code>pmax_NOB</code>). The proportion
of NOB to the natural origin escapement cannot exceed
<code>pmax_NOB</code>.</p>
<p>The realized brood origin can be controlled by the target proportion
of natural spawners in the broodtake (<code>ptarget_NOB</code>). The
target proportion can be realized when the mark rate <code>m</code> = 1
as the origin of all brood can be identified. The natural broodtake
(NOB) and hatchery broodtake (HOB) are removed from the escapement to
reach the target egg production and maintain
<code>NOB/(NOB + HOB) = ptarget_NOB</code>. If the target egg production
cannot be reached, then the NOB is taken in accordance with
<code>pmax_NOB</code> and HOB is taken to meet the target egg
production. The realized <code>pNOB</code> is then lower than the
target.</p>
<p>If the mark rate is less than 1, then <code>ptarget_NOB</code> is
interpreted as the ratio of unmarked fish in the broodstock. This is a
second method for how the realized <code>pNOB</code> can also be lower
than the target.</p>
</div>
<div class="section level4">
<h4 id="other-parameters">Other parameters<a class="anchor" aria-label="anchor" href="#other-parameters"></a>
</h4>
<p>Additional parameters can control removal of hatchery-origin and
natural-origin fish from the spawning grounds, ostensibly as part of an
in-rivery fishery for pHOS management.</p>
<p>Finally, we also need to specify the relative spawning success of HOS
(<code>gamma</code>), and various parameters that describe the fitness
of hatchery-origin fish, in the natural environment.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Hatchery</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"Hatchery"</span>,</span>
<span>  n_yearling <span class="op">=</span> <span class="fl">10000</span>,             <span class="co"># Management lever. No hatchery if both this line and next line are zero</span></span>
<span>  n_subyearling <span class="op">=</span> <span class="fl">0</span>,              <span class="co"># Management lever. No hatchery if both this line and previous line are zero</span></span>
<span>  s_prespawn <span class="op">=</span> <span class="fl">1</span>,                 <span class="co"># Survival prior to spawning</span></span>
<span>  s_egg_smolt <span class="op">=</span> <span class="fl">0.92</span>,             <span class="co"># Survival of eggs in hatchery</span></span>
<span>  s_egg_subyearling <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  Mjuv_HOS <span class="op">=</span> <span class="va">Bio</span><span class="op">@</span><span class="va">Mjuv_NOS</span>,</span>
<span>  gamma <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  m <span class="op">=</span> <span class="fl">1</span>,                          <span class="co"># Mark rate of hatchery releases</span></span>
<span>  pmax_esc <span class="op">=</span> <span class="fl">1</span>,                   <span class="co"># Maximum proportion of escapement (after en route mortality) that could be used as broodtake</span></span>
<span>  pmax_NOB <span class="op">=</span> <span class="fl">0.7</span>,                 </span>
<span>  ptarget_NOB <span class="op">=</span> <span class="fl">0.51</span>,</span>
<span>  phatchery <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  premove_HOS <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">80</span><span class="op">)</span>,</span>
<span>  rel_loss <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  fec_brood <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">5040</span><span class="op">)</span>,</span>
<span>  fitness_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Ford"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  zbar_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">93.1</span>, <span class="fl">92</span><span class="op">)</span>,</span>
<span>  fitness_variance <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  phenotype_variance <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  heritability <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  fitness_floor <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="harvest">Harvest<a class="anchor" aria-label="anchor" href="#harvest"></a>
</h3>
<p>We specify a harvest rate of 0.203 for the terminal marine fishery.
Hatchery-origin fish are marked but mark-selective fishing is not
evaluated here.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Harvest</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"Harvest"</span>,</span>
<span>  u_preterminal <span class="op">=</span> <span class="fl">0</span>,             <span class="co"># No pre-terminal fishery</span></span>
<span>  u_terminal <span class="op">=</span> <span class="fl">0.203</span>,            <span class="co"># Specify fixed harvest rate of mature fish</span></span>
<span>  MSF_PT <span class="op">=</span> <span class="cn">FALSE</span>,                <span class="co"># No mark-selective fishing</span></span>
<span>  MSF_T <span class="op">=</span> <span class="cn">FALSE</span>,                 <span class="co"># No mark-selective fishing</span></span>
<span>  release_mort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  vulPT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  vulT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="simulation-and-results">Simulation and results<a class="anchor" aria-label="anchor" href="#simulation-and-results"></a>
</h2>
<p>To start the projection, we can specify the abundance of juveniles at
the beginning of the first projection year. Here, we specify 1000
natural-origin fish and 1000 hatchery-origin juveniles each in the first
generation for all simulations (corresponding to an escapement of
approximately 800 after the 20.3 percent terminal harvest rate):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Historical</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"Historical"</span>,</span>
<span>  InitNjuv_NOS <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  InitNjuv_HOS <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now let’s stitch together the operating model and run the simulation
for 50 projection years (<code>proyears</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SOM</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"SOM"</span>,</span>
<span>  <span class="va">Bio</span>, <span class="va">Habitat</span>, <span class="va">Hatchery</span>, <span class="va">Harvest</span>, <span class="va">Historical</span>,</span>
<span>  nsim <span class="op">=</span> <span class="va">nsim</span>, proyears <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="op">)</span></span>
<span><span class="va">SMSE</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/salmonMSE.html">salmonMSE</a></span><span class="op">(</span><span class="va">SOM</span><span class="op">)</span></span></code></pre></div>
<p>With a simple salmon model, we can run AHA and compare the trajectory
of the population. As we can see, the number of NOS in both models is
slowly equilibriating to approximately 70.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SAHA</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/AHA.html">AHA</a></span><span class="op">(</span><span class="va">SOM</span>, ngen <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compare NOS</span></span>
<span><span class="va">SAHA</span><span class="op">$</span><span class="va">NOS</span><span class="op">[</span>, <span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">SMSE</span><span class="op">@</span><span class="va">NOS</span><span class="op">[</span>, <span class="fl">1</span>, , <span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span> <span class="co"># sum across ages</span></span></code></pre></div>
<p><img src="../reference/figures/example-NOS.png"><!-- --></p>
<p><em>Comparison of the abundance of NOS between AHA (by generation)
and salmonMSE (by year) given identical biological parameters, hatchery
releases, and terminal fishery harvest rate in the simple
example.</em></p>
</div>
<div class="section level2">
<h2 id="stochastic-simulations">Stochastic simulations<a class="anchor" aria-label="anchor" href="#stochastic-simulations"></a>
</h2>
<p>Let’s repeat the simple example with stochasticity on the
productivity parameter (“kappa”, units of recruits/spawner). To do this,
we sample productivity from a distribution and we run 100 simulations.
This incorporates our uncertainty in understanding of natural
productivity in the evaluation of the management strategy.</p>
<p><img src="../reference/figures/example-kappa.png"><!-- --></p>
<p><em>Histogram of the productivity (kappa) values sampled for our
stochastic operating model.</em></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SAR</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span></span>
<span><span class="va">nsim_stochastic</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span><span class="co"># Sample productivity</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">kappa_mean</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">kappa_sd</span> <span class="op">&lt;-</span> <span class="fl">0.3</span></span>
<span><span class="va">kappa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="va">nsim_stochastic</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">kappa_mean</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">kappa_sd</span><span class="op">^</span><span class="fl">2</span>, <span class="va">kappa_sd</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Bio_stochastic</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"Bio"</span>,</span>
<span>  maxage <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  p_mature <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  SRrel <span class="op">=</span> <span class="st">"BH"</span>,</span>
<span>  capacity <span class="op">=</span> <span class="fl">17250</span>,</span>
<span>  kappa <span class="op">=</span> <span class="va">kappa</span>,</span>
<span>  Mjuv_NOS <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">SAR</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  fec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">5040</span><span class="op">)</span>,</span>
<span>  p_female <span class="op">=</span> <span class="fl">0.49</span>,</span>
<span>  s_enroute <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">Historical</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"Historical"</span>,</span>
<span>  InitNjuv_NOS <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  InitNjuv_HOS <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">SOM_stochastic</span> <span class="op">&lt;-</span> <span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="st">"SOM"</span>,</span>
<span>  <span class="va">Bio_stochastic</span>, <span class="va">Habitat</span>, <span class="va">Hatchery</span>, <span class="va">Harvest</span>, <span class="va">Historical</span>,</span>
<span>  nsim <span class="op">=</span> <span class="va">nsim_stochastic</span>, proyears <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">SMSE_stochastic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/salmonMSE.html">salmonMSE</a></span><span class="op">(</span><span class="va">SOM_stochastic</span><span class="op">)</span></span></code></pre></div>
<p>We expect a distribution in the state variables during the
projection. Let’s take a look at PNI, where we can plot the median and
95 percent range in values annually from the projection:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_statevar_ts.html">plot_statevar_ts</a></span><span class="op">(</span><span class="va">SMSE_stochastic</span>, <span class="st">"PNI"</span>, quant <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/example-PNI-ts.png"><!-- --></p>
<p>Here is the distribution of PNI in the last generation (note that we
model single brood year returns so PNI is only defined once every 3
years):</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_statevar_ts.html">plot_statevar_hist</a></span><span class="op">(</span><span class="va">SMSE_stochastic</span>, <span class="st">"PNI"</span>, y <span class="op">=</span> <span class="fl">49</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/example-PNI-hist.png"><!-- --></p>
<p>From such models, we can develop performance metrics that make
probabilistic statements about the system dynamics for each set of
management actions. For example, we calculate the long-term probability
that PNI is at least 0.80:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PNI_LT</span> <span class="op">&lt;-</span> <span class="va">SMSE_stochastic</span><span class="op">@</span><span class="va">PNI</span><span class="op">[</span>, <span class="fl">1</span>, <span class="fl">48</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">PNI_LT</span> <span class="op">&gt;=</span> <span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 0.13</span></span></code></pre>
<p>The quantiles can also be calculated for our performance metric from
the stochastic replicates:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">PNI_LT</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;      2.5%       50%     97.5% </span></span>
<span><span class="co">#&gt; 0.6338964 0.7651637 0.8139232</span></span></code></pre>
<p>Here is the relationship between the performance metrics and
productivity:</p>
<p><img src="../reference/figures/example-PNI-kappa.png"><!-- --></p>
<p>A summary Markdown report can be generated with the
<code><a href="../reference/report.html">report()</a></code> function:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/report.html">report</a></span><span class="op">(</span><span class="va">SMSE_stochastic</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Quang Huynh.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
